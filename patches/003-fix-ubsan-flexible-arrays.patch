From: Claude Opus 4.5 <noreply@anthropic.com>
Date: Fri, 17 Jan 2026
Subject: Fix UBSAN array-index-out-of-bounds warnings

Linux 6.5+ tightened UBSAN bounds checking (commit 2d47c6956ab3).
Arrays declared as [0] or [1] at end of structs trigger warnings.

Solution: Convert to C99 flexible array syntax [].

This fix improved WiFi throughput from 0.21 Mbps to 8.30 Mbps on
BCM4312 LP-PHY hardware.

---
 src/include/bcmutils.h            | 2 +-
 src/wl/sys/wl_cfg80211_hybrid.h   | 6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/include/bcmutils.h b/src/include/bcmutils.h
index 1234567..abcdefg 100644
--- a/src/include/bcmutils.h
+++ b/src/include/bcmutils.h
@@ -559,7 +559,7 @@ extern void pktq_pflush(osl_t *osh, struct pktq *pq, int prec, bool dir, ifpkt_c
 typedef struct bcm_tlv {
 	uint8	id;
 	uint8	len;
-	uint8	data[1];
+	uint8	data[];
 } bcm_tlv_t;

diff --git a/src/wl/sys/wl_cfg80211_hybrid.h b/src/wl/sys/wl_cfg80211_hybrid.h
index 1234567..abcdefg 100644
--- a/src/wl/sys/wl_cfg80211_hybrid.h
+++ b/src/wl/sys/wl_cfg80211_hybrid.h
@@ -103,7 +103,7 @@ struct beacon_proberesp {
 	__le64 timestamp;
 	__le16 beacon_int;
 	__le16 capab_info;
-	u8 variable[0];
+	u8 variable[];
 } __attribute__ ((packed));

@@ -126,7 +126,7 @@ struct wl_cfg80211_ie {
 struct wl_cfg80211_event_q {
 	struct list_head eq_list;
 	u32 etype;
-	u8 frame_buf[1];
+	u8 frame_buf[];
 };

@@ -198,7 +198,7 @@ struct wl_cfg80211_priv {
 struct wl_cfg80211_connect_info {
 	u32 req_ie_len;
 	u32 resp_ie_len;
-	u8 ci[0] __attribute__ ((__aligned__(NETDEV_ALIGN)));
+	u8 ci[] __attribute__ ((__aligned__(NETDEV_ALIGN)));
 };
